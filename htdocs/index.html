<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Public NTP Server</title>
<link href="lib/bootstrap-4.3.1/css/bootstrap.min.css" rel="stylesheet">
<style>
    body {
        font-family: -apple-system,BlinkMacSystemFont,"Segoe UI","Helvetica Neue",Arial,"Noto Sans",sans-serif;
        margin-left: 25px;
        margin-right: 25px;
      }
      #logo-row {
        margin-top: 10px;
        margin-bottom: 20px;
        height: 75px;
      }
      #logo-row > div {
        height: 100%;
        padding-left: 0px;
        padding-right: 0px;
        vertical-align: middle;
      }
      .logo {
        max-height: 100%;
        max-width: 85%;
        display: block;
        margin-left: auto;
        margin-right: auto;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }
#ntp-status {
  white-space: pre;
}
</style>
</head>
<body class="bg-light">
    <div id="logo-row" class="row">
      <div class="col">
        <a href="https://batc.org.uk/" target="_blank">
          <img class="logo" src="/img/batc-logo-150px.png" alt="British Amateur Television Club">
        </a>
      </div>
      <div class="col">
        <a href="https://amsat-uk.org/" target="_blank">
          <img class="logo" src="/img/amsatuk-logo-150px.png" alt="Amateur Satellites - United Kingdom">
        </a>
      </div>
      <div class="col">
        <a href="https://www.goonhilly.org/" target="_blank">
          <img class="logo" src="/img/ges-logo-blue-400px.png" alt="Goonhilly Earth Station">
        </a>
      </div>
    </div>

<a href="ntp_rack.jpg" target="_blank"><img src="ntp_rack.jpg" alt="LeoNTP Server in rack at Goonhilly" style="float:right;width:25%;"></a>
<h3>Public NTP Server Statistics</h3>
NTP response: <span id="ntp-response-datetime"></span> (<span id="ntp-response-timestamp"></span>)<br>
Total NTP requests served: <span id="ntp-requests-total"></span><br>
32-bit counter overflows detected: <span id="ntp-requests-overflows"></span><br>
Uptime: <span id="ntp-device-uptime-seconds"></span> seconds ( <span id="ntp-device-uptime-days"></span> days )<br>
Average load since restart: ~<span id="ntp-requests-rate"></span> requests per second<br>
GPS lock since: <span id="ntp-gps-uptime-seconds"></span> seconds ( <span id="ntp-gps-uptime-days"></span> days )<br>
GPS flags: <span id="ntp-gps-flags"></span><br>
Active satellites: <span id="ntp-gps-svs"></span><br>
Firmware version: <span id="ntp-device-firmware"></span><br>
Serial number: <span id="ntp-device-serial"></span><br>
<br>
<ul>
<li>Hardware: <a href="http://store.uputronics.com/index.php?route=product/product&product_id=92" target="_blank">LeoNTP GPS Network Master Clock</a></li>
<li>NTP Pool (Global, Europe, UK): <a href="http://www.pool.ntp.org/scores/185.83.169.27" target="_blank">185.83.169.27</a></li>
</ul>
<br>	
20 minutes traffic, 1 second average:<br>
<img id="img-20m" border="0" alt="20 min" src="20m.png"  height="291" width="1257" style="margin-bottom:.25em;vertical-align:middle;">
<br><br>

2 hours traffic, 1 second average:<br>
<img id="img-2h" border="0" alt="2 hours" src="2h.png"  height="291" width="1257" style="margin-bottom:.25em;vertical-align:middle;">
<br><br>

12 hours traffic, 1 second average:<br>
<img id="img-12h" border="0" alt="12 hours" src="12h.png"  height="291" width="1257" style="margin-bottom:.25em;vertical-align:middle;">
<br><br>

2 days traffic, 1 second average:<br>
<img id="img-2d" border="0" alt="2 days" src="48h.png" height="291" width="1257" style="margin-bottom:.25em;vertical-align:middle;">
<br><br>

10 days traffic, 1 second average:<br>
<img id="img-10d" border="0" alt="10 days" src="10d.png" height="291" width="1257" style="margin-bottom:.25em;vertical-align:middle;">
<br><br>

1 month traffic, 1 hour average:<br>
<img id="img-1mo" border="0" alt="1 month" src="30d.png" height="291" width="1257" style="margin-bottom:.25em;vertical-align:middle;">
<br><br>

1 year traffic, 1 day average:<br>
<img id="img-1y" border="0" alt="1 year" src="1y.png"  height="291" width="1257" style="margin-bottom:.25em;vertical-align:middle;">
<br>	

<img id="img-ntppool" src="https://www.ntppool.org/graph/185.83.169.27/offset.png" alt="Server offset graph" height="116" width="250">
</body>
<script src="lib/jquery-3.4.1.min.js"></script>
<script src="lib/bootstrap-4.3.1/js/bootstrap.min.js"></script>
<script>
var ntp_status_spans = {
  'ntp-response-datetime': $('#ntp-response-datetime'),
  'ntp-response-timestamp': $('#ntp-response-timestamp'),
  'ntp-requests-total': $('#ntp-requests-total'),
  'ntp-requests-rate': $('#ntp-requests-rate'),
  'ntp-requests-overflows': $('#ntp-requests-overflows'),
  'ntp-gps-uptime-seconds': $('#ntp-gps-uptime-seconds'),
  'ntp-gps-uptime-days': $('#ntp-gps-uptime-days'),
  'ntp-gps-flags': $('#ntp-gps-flags'),
  'ntp-gps-svs': $('#ntp-gps-svs'),
  'ntp-device-uptime-seconds': $('#ntp-device-uptime-seconds'),
  'ntp-device-uptime-days': $('#ntp-device-uptime-days'),
  'ntp-device-serial': $('#ntp-device-serial'),
  'ntp-device-firmware': $('#ntp-device-firmware'),
};
function update_ntp_fields(status)
{
  for (var status_field in status)
  {
    ntp_status_spans[status_field].text(status[status_field]);
  }
}

function update_ntp_status()
{
  var request = new XMLHttpRequest();
  request.open('GET', 'ntp_status.json', true);
  request.onload = function() {
    if (request.status >= 200 && request.status < 400) {
      update_ntp_fields(JSON.parse(request.responseText));
      setTimeout(update_ntp_status, 1*1000);
    }
  };
  request.send();
}
update_ntp_status();

var ntp_20m_img = document.getElementById("img-20m");
var ntp_2h_img = document.getElementById("img-2h");
var ntp_12h_img = document.getElementById("img-12h");
var ntp_2d_img = document.getElementById("img-2d");
var ntp_10d_img = document.getElementById("img-10d");
var ntp_30d_img = document.getElementById("img-1mo");
var ntp_pool_img = document.getElementById("img-ntppool");
function update_rrd_images()
{
  var cacheBuster = new Date().getTime();

  ntp_20m_img.src = "20m.png#" + cacheBuster;
  ntp_2h_img.src = "2h.png#" + cacheBuster;
  ntp_12h_img.src = "12h.png#" + cacheBuster;
  ntp_2d_img.src = "48h.png#" + cacheBuster;
  ntp_10d_img.src = "10d.png#" + cacheBuster;
  ntp_30d_img.src = "30d.png#" + cacheBuster;
  ntp_pool_img.src = "https://www.ntppool.org/graph/185.83.169.27/offset.png#" + cacheBuster;

  setTimeout(update_rrd_images, 30*1000);
}
setTimeout(update_rrd_images, 30*1000);
</script>
</html>
